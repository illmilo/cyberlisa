{% extends 'agents/agents.html' %}

{% block title %}Servers{% endblock %}
{% block header %}Servers{% endblock %}

{% block list-header %}Server{% endblock %}
{% block create-header %}Server{% endblock %}

{% block form-groups %}
    <div class="form-group">
        <label for="name">Server Name</label>
        <input type="text" id="name" name="name" placeholder="Enter server name">
    </div>

    <div class="form-group">
        <label for="address">Server Address</label>
        <input type="text" id="address" name="address" placeholder="Enter server address" required>
    </div>
    
    <div class="form-group">
        <label for="port">Server Port</label>
        <input type="number" id="port" name="port" placeholder="Enter server port" required>
    </div>
    
    <div class="form-group">
        <label for="password">Root Password</label>
        <input type="password" id="password" name="password" placeholder="Enter root password" required>
    </div>

    <div class="form-group">
        <label for="key">Server Key</label>
        <input type="text" id="key" name="key" placeholder="Enter server key (SSH, etc)" required>
    </div>
{% endblock %}

{% block script %}
    <script src="{% static 'js/dataLoader.js' %}"></script>
    <script src="{% static 'js/listRenderer.js' %}"></script>
    <script src="{% static 'js/dropdownLoader.js' %}"></script>
    <script src="{% static 'js/dataDeleter.js' %}"></script>
    <script src="{% static 'js/dataPoster.js' %}"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const serverLoader = new DataLoader('http://localhost:8000/servers', 'server');

            // list render
            const serverRenderer = new ItemRenderer('server', serverLoader, '.list-content');

            // delete
            const serverDeleter = new DataDeleter(serverLoader, serverRenderer, {
                confirmMessage: 'Delete server {id}?',
                successMessage: 'Server {id} deleted successfully'
            });
            serverDeleter.setupDeletionListener();

            // post
            const serverPoster = new DataPoster(
                serverLoader, 
                serverRenderer,
                {
                    formId: 'server-form',
                    fieldMappings: {
                        name: 'name',
                        address: 'address',
                        port: 'port',
                        password: 'password',
                        key: 'key'
                    }
                }
            );
        });
    </script>
{% endblock %}